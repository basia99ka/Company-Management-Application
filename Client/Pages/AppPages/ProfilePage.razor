@page "/profilePage"
@using SharedLibrary.DTOs
@using Client.ApplicationStates
@using System.Security.Claims
@inject ProfileState ProfileState
<div class="container mt-2">
    <div class="row">
        <div class="col-lg-2"> </div>
        <div class="col-lg-8">
            <EditForm Model="ProfileState.Profile" >
                <DataAnnotationsValidator />
                <div class="card bg-dark" style="opacity:0.85; border-radius:10px; color: #fbf9f9; font-weight:bold;">
                    <div class="card-header text-center fs-5">Personal Information</div>
                    <div class="card-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-2"></div>
                            <div class="col-lg-8 d-flex justify-content-center align-items-center">
                                 <img style="border-radius:50%;"  height="175" width="175" src="/images/profile/default.jpg"/>    
                             </div>
                              <div class="col-lg-2"></div>
                        </div>
                    </div>
                        <div class="form-group ">
                            <label class="form-label">Id</label>
                            <input type="text" value="@ProfileState.Profile.Id" class="form-control" disabled/>
                        </div>
                        <div class="form-group ">
                            <label class="form-label">Name</label>
                            <input type="text" value="@ProfileState.Profile.Name" class="form-control" disabled/>
                        </div>
                        <div class="form-group ">
                            <label class="form-label">Email</label>
                            <input type="text" value="@ProfileState.Profile.Email" class="form-control" disabled/>
                        </div>                   
                    </div>

                    <div class="card-footer text-center">
                        <ValidationSummary />
                    </div>
                </div>
            </EditForm>
        </div>
        <div class="col-lg-2"></div>
    </div>
</div>

@code {

protected async override Task OnInitializedAsync()
    {
        await Load();
        ProfileState.Action += StateHasChanged;
    }
    
    private async Task Load()
    {
        try
        {
            
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            ProfileState.Profile.Id = authState.User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)!.Value;
            ProfileState.Profile.Name = authState.User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Name)!.Value;
            ProfileState.Profile.Email = authState.User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Email)!.Value;
                           return;
        } 
        catch{}
    }



    }


 
